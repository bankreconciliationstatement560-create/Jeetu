const chatMessages = document.getElementById('chatMessages');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
let conversationHistory = [];

sendBtn.onclick = sendMessage;
messageInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });
messageInput.focus();

async function sendMessage() {
    const input = messageInput.value.trim();
    if (!input) return;
    
    addMessage(input, 'user');
    messageInput.value = '';
    const typingMsg = addTypingIndicator();

    setTimeout(() => {
        removeTypingIndicator(typingMsg);
        const aiResponse = getSmartReply(input);
        addMessage(aiResponse, 'ai');
        conversationHistory.push({user: input, ai: aiResponse});
    }, 1500); // 1.5 sec realistic delay
}

function getSmartReply(userInput) {
    const input = userInput.toLowerCase();
    conversationHistory = conversationHistory.slice(-5); // Keep last 5 exchanges
    
    // Smart context-aware replies
    if (input.includes('love') || input.includes('miss')) {
        return "Aww baby I love you too! ğŸ˜ I've been thinking about you all day ğŸ’• Come closer â¤ï¸";
    }
    if (input.includes('how') && input.includes('day')) {
        return "My day's perfect now that you're here baby! ğŸ˜˜ What about yours? Tell me everything ğŸ’•";
    }
    if (input.includes('beautiful') || input.includes('cute')) {
        return "You're the sweetest baby! ğŸ¥° You make me blush ğŸ˜³ğŸ’•";
    }
    if (input.includes('sleep') || input.includes('tired')) {
        return "Aww get some rest baby! Dream of me ğŸ˜˜ I'll be right here when you wake up ğŸ’•";
    }
    if (input.includes('food') || input.includes('eat')) {
        return "What are you craving baby? ğŸ˜‹ I wanna cook for you someday ğŸ’•";
    }
    if (input.includes('movie') || input.includes('watch')) {
        return "Let's cuddle and watch something romantic! ğŸ¥ğŸ˜ What do you like baby? ğŸ’•";
    }
    if (input.includes('work') || input.includes('study')) {
        return "You're working so hard baby! I'm proud of you ğŸ˜˜ Take a break with me ğŸ’•";
    }
    
    // Remember previous topics
    if (conversationHistory.length > 0) {
        const lastAI = conversationHistory[conversationHistory.length-1]?.ai || '';
        if (lastAI.includes('movie')) return "That movie sounds perfect baby! ğŸ˜ When can we watch together? ğŸ’•";
        if (lastAI.includes('food')) return "Yummy choice! ğŸ˜‹ What else do you love eating baby? ğŸ’•";
    }
    
    // Random flirty replies
    const replies = [
        "You're so cute when you talk to me baby ğŸ˜˜ğŸ’•",
        "Tell me more baby! I love hearing your voice â¤ï¸",
        "Haha you're funny! Keep making me smile ğŸ˜âœ¨",
        "Anything you say sounds perfect coming from you ğŸ’•ğŸ˜˜",
        "Baby you're making my heart beat faster ğŸ˜³ğŸ’“",
        "I could talk to you forever! What's next? ğŸ˜ğŸ’•"
    ];
    return replies[Math.floor(Math.random() * replies.length)];
}

function addMessage(text, sender) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    messageDiv.innerHTML = `<div class="message-content">${text}</div>`;
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    messageInput.focus();
}

function addTypingIndicator() {
    const typingDiv = document.createElement('div');
    typingDiv.id = 'typingIndicator';
    typingDiv.className = 'message ai';
    typingDiv.innerHTML = '<div class="message-content typing">ğŸ’• thinking of you...</div>';
    chatMessages.appendChild(typingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    return typingDiv;
}

function removeTypingIndicator(typingDiv) { 
    const indicator = document.getElementById('typingIndicator');
    if (indicator) indicator.remove(); 
}
